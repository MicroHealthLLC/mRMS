<li class="nav-item mb-3" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" title="<%= 'Create Channel' %>">
  <a href="/channels/new" class="nav-link btn btn-icon btn-clean btn-lg <%= menu_active?('channels', 'new') %>" >
    <span class="svg-icon svg-icon-xl">
      <i class="flaticon-add"></i>
    </span>
  </a>
</li>

<li class="nav-item mb-3" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" title="<%= 'Request Channel' %>" >
  <a href="#" class="nav-link btn btn-icon btn-clean btn-lg" data-toggle="modal" data-target="#RequestEntranceModal">
    <span class="svg-icon svg-icon-xl">
      <i class="fa-lg fa-fw fas fa-bowling-ball"></i>
    </span>
  </a>
</li>

<% @ordered_channels.each do |channel_id| %>
  <% if channel_id == -1 %>
    <li class="nav-item mb-3 sort-handle" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" title="Personal" data-reorder-url="<%= reorder_handle_channels_path(channel_id: '-1') %>" data-reorder-param="<%= 'channel' %>">
      <a href="#" class="nav-link btn btn-icon btn-clean btn-lg" data-toggle="modal" data-target="#RequestEntranceModal">
        <span class="svg-icon svg-icon-xl">
          <i class="fa fa-lg fa-fw fa-circle"></i>
        </span>
      </a>

      <!-- <ul>
        <%# Channel.shared_report %>
        <%# Channel.my_personal_channel.each do |channel| %>
            <li class="<%#= channel_active?(channel)  %>">
              <a href="/channels/<%#= channel.id %>" title="<%#= channel.name %>"><i class="fa-lg fa-fw <%#= channel.icon || 'far fa-square' %>"></i><span class="menu-item-parent"><%#= channel.name %></span></a>
            </li>
        <%# end  %>
      </ul -->

    </li>

    <% elsif channel = Channel.not_personal.find_by_id(channel_id) %>
      <li class="nav-item mb-3 sort-handle" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" title="<%= channel.name %>" data-reorder-url="<%= reorder_handle_channels_path(channel_id: channel ? channel.id : '-1') %>" data-reorder-param="<%= 'channel' %>">
        <a href="/channels/<%= channel.id %>" class="nav-link btn btn-icon btn-clean btn-lg <%= channel_active?(channel) %>">
          <span class="svg-icon svg-icon-xl">
            <i class="fa-lg fa-fw <%= channel.icon || 'far fa-square' %>"></i>
          </span>
        </a>
      </li>
    <% end %>
<% end %>

<li class="nav-item mb-3" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" title="<%= 'One Drives' %>">
  <a href="/one_drives" class="nav-link btn btn-icon btn-clean btn-lg <%= menu_active?('one_drives') %>">
    <span class="svg-icon svg-icon-xl">
      <i class="fa-lg fa-fw fab fa-dropbox"></i>
    </span>
  </a>
</li>

<% if module_enabled?('news') && can?(:manage_roles, :manage_news, :view_news) %>
  <li class="nav-item mb-3" data-toggle="tooltip" data-placement="right" data-container="body" data-boundary="window" data-original-title="<%= 'news' %>">
    <a href="/news" class="nav-link btn btn-icon btn-clean btn-lg <%= menu_active?('news') %>">
      <span class="svg-icon svg-icon-xl">
        <i class="fa fa-lg fa-fw fa-newspaper-o"></i>
      </span>
    </a>
  </li>
<% end %>

<style>
  li .fa-sort{
    display: none;
  }
</style>

<script>
    $(document).ready(function(){
        $( ".sort-handle" ).hover(
            function() {
                $(this).find('.fa-sort').show(20)

            }, function(){
                $(this).find('.fa-sort').hide(20)
            }
        )
        $( "#sortable" ).sortable({
            items: "li.sort-handle",
            placeholder: "ui-state-highlight",
            update: function(event, ui) {
                var sortable = $(this);
                var handle = $(ui.item[0])
                var url = handle.data("reorder-url");
                var param = handle.data("reorder-param");
                var data = {};
                data[param] = {position: ui.item.index() + 1 - 2};
                $.ajax({
                    url: url,
                    type: 'put',
                    dataType: 'script',
                    data: data,
                    success: function(data){
                        console.log(data)
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert(jqXHR.status);
                        sortable.sortable("cancel");
                    },
                    complete: function(jqXHR, textStatus, errorThrown){
                        handle.removeClass("ajax-loading");
                    }
                });
            }
        });
        $( "#sortable" ).disableSelection();
    })
</script>
